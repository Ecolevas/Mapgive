---
layout: default
title: Imagery to the Crowd 
twitterDescription: "#HIU through #ITTC publishes high-resolution commercial satellite imagery services for humanitarian response."
ogDescription: "#HIU through #ITTC publishes high-resolution commercial satellite imagery services for humanitarian response."
emailSubject: HIU through ITTC publishes imagery services.
emailDescription: "#HIU through #ITTC publishes high-resolution commercial satellite imagery services for humanitarian response."
---

<div class="row">
  <div class="col-md-8">
    <header role="header">
      <h1 class="page-title">{{ page.title }}</h1>
    </header>
  </div>
  <div class="col-md-offset-1 col-md-3">
    {% include social-media.html %}
  </div>
</div>

<div class="row">
  
  	<!--The col-md-offset centers the div, but the bootstrap div is messing with the leaflet map
  	<div class="col-md-10 col-md-offset-1"> -->

  	<div id="map" style="margin-left: auto; margin-right: auto; width: 80%; height: 400px"></div>
  	
  	<!--TurfJS link-->
  	<script src='https://api.tiles.mapbox.com/mapbox.js/plugins/turf/v1.3.0/turf.min.js'></script>
  	
  	<script>

		var map = L.map('map').setView([15, 25], 2);
		
		var pinLayer = L.featureGroup([]);
		
		//zoom listener from: http://stackoverflow.com/questions/19658564/leaflet-control-geojson-layers-by-zoom-level
		map.on('zoomend', function (e) {
			myZoomHandler();
		});
		
		function myZoomHandler() {
			var currentZoom = map.getZoom();
			switch (currentZoom) {
				case 4:
					$(".mapgiveIcon").css("visibility", "visible");
					$(".requestPolygons").css("visibility", "hidden");
				break;
				case 5:
				    $(".mapgiveIcon").css("visibility", "hidden");
				    $(".requestPolygons").css("visibility", "visible");
				    //tried to use .cleatLayers but it was getting rid of all the layer references, so I was not able to re-add the layer again
				    //copiedpinLayer.clearLayers(copiedpinLayer.getLayers());
				break;
				default:
				    // etc
				break;
			}
		}
		
		//L.tileLayer('https://{s}.tiles.mapbox.com/v3/{id}/{z}/{x}/{y}.png', {
		L.tileLayer('http://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png', {
			maxZoom: 18,
			attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
				'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a> ',
			id: 'examples.map-i875mjb7'
		}).addTo(map);

		//used Inkscape to save MapGive icon: http://inkscapetutorials.org/2014/04/22/inkscape-faq-how-do-i-crop-in-inkscape/#document
		var mapgiveIcon = L.icon({
		    iconUrl: "{{ site.baseurl }}/assets/img/mapgive_red_pt.svg",
		    iconSize: [30, 45],
		    iconAnchor: [15, 40],
		    popupAnchor: [0, 0],
          	//opacity: .5,
          	//fillOpacity: 0.7,
          	//You can also give a style a className property! : http://stackoverflow.com/questions/17086195/leaflet-path-how-can-i-set-a-css-class
          	className: "mapgiveIcon"

		});
		
		var requestPolygons = {
			//"color": "#ff7800",
			//"weight": 5,
			//"opacity": 0.65,
			className: "requestPolygons"
		};

		//returns an array of objects according to key, value, or key and value matching
		function getObjects(obj, key, val) {
			var objects = [];
			for (var i in obj) {
				if (!obj.hasOwnProperty(i)) continue;
				if (typeof obj[i] == 'object') {
					objects = objects.concat(getObjects(obj[i], key, val));    
				} else 
				//if key matches and value matches or if key matches and value is not passed (eliminating the case where key matches but passed value does not)
				if (i == key && obj[i] == val || i == key && val == '') { //
					objects.push(obj);
				} else if (obj[i] == val && key == ''){
					//only add if the object is not already in the array
					if (objects.lastIndexOf(obj) == -1){
						objects.push(obj);
					}
				}
			}
			return objects;
		}

		var popupOptions = {maxWidth: 200};
		var popupContent = "<h4> HOT OSM projects: </h4>";
		
		function popupContentFunction(projects,popupContent) {
		
			if (projects.indexOf(",") > 0) {
				projects = projects.split(",")
				console.log(projects);
				//var popupContent = "<h4> HOT OSM projects: </h4>";
				console.log('test popupContent: ');
				console.log(popupContent);
				for (i=0;i<projects.length;i++) {
					var popupContent = popupContent + "<h4><a href=http://tasks.hotosm.org/project/" + projects[i] + 
					">" + projects[i] + "</a></h4>";
				}
				
				console.log('test popupContent return: ');
				console.log(popupContent);
				return popupContent;
			
			} else if (projects == "none"){
				var popupContent = "<h4> HOT OSM project: none </h4>";
				return popupContent;
			} else {
				var popupContent = "<h4><a href=http://tasks.hotosm.org/project/" + projects + 
				"> HOT OSM project: " + projects + "</a></h4>";
				return popupContent;
			}
		}
		
		$.getJSON("{{ site.baseurl }}/ittc_services.geojson", function(data) {
			//uses getObjects function, which parses geojson for objects that match a certain key:value
			test_json = getObjects(data,'type','FeatureCollection');

			for (var i in test_json) {
		
				//The geojson has one outer FeatureCollection object, which contains all of the
				//other FeatureCollections. The outer FeatureCollection object has no properties object
				if (test_json[i].hasOwnProperty('properties')) {

					var projects = test_json[i].properties.tm_projects

					L.geoJson(test_json[i], {
						onEachFeature: function (feature, layer) {
							layer.bindPopup(popupContentFunction(projects,popupContent),popupOptions).setStyle(requestPolygons);
						}
					}).addTo(map);
					
					//making requestPolygons hidden right away after page load
					$(".requestPolygons").css("visibility", "hidden");
					
					//Turf JS centroid function
					var centroidPt = turf.centroid(test_json[i]);

					L.geoJson(centroidPt, {
						onEachFeature: function (feature, layer) {
							layer.bindPopup(popupContentFunction(projects,popupContent),popupOptions).setIcon(mapgiveIcon);
						}
					}).addTo(map);
				}
			}
			
			pinLayer.addTo(map);
			
		});

	</script>

<div class="col-md-12">
<br>
<section>
	<p>Imagery to the Crowd (IttC) is part of the State Departmentâ€™s Humanitarian Information Unit (HIU). The HIU provides information to decision-makers and partners in preparation for and response to humanitarian emergencies worldwide, promotes innovative technologies and best practices for humanitarian information management. IttC publishes high-resolution commercial satellite imagery purchased by the United States Government, in a format that volunteers easily map into OpenStreetMap. IttC addresses significant data gaps for humanitarian and development needs.</p>
</section>
<br>
</div>


